-- ğŸ¯ ä¼ä¸šçº§5æœåŠ¡å•†æ¶æ„å‡çº§ï¼ˆ2025ä¼˜åŒ–ç‰ˆï¼‰
-- 3å±‚èšåˆæ¶æ„ï¼šä¸»åŠ›(3) + å…œåº•(2)
-- ç§»é™¤ï¼šSimplex, Transak, Banxa (è¢«èšåˆå™¨è¦†ç›–æˆ–åŠŸèƒ½é‡å )
-- æ–°å¢ï¼šOnramper(èšåˆå™¨), TransFi(ä¸­å›½ç‰¹åŒ–), Alchemy Pay(Web3)

-- Step 1: æ¸…ç†æ—§æ•°æ®
DELETE FROM fiat.providers;

-- Step 2: æ’å…¥æ–°çš„5æœåŠ¡å•†é…ç½®

-- âœ… ä¸»åŠ›1: Onramper - èšåˆå™¨(ä¼˜å…ˆçº§100)
INSERT INTO fiat.providers (
    id,
    name,
    display_name,
    is_enabled,
    priority,
    fee_min_percent,
    fee_max_percent,
    api_url,
    webhook_url,
    timeout_seconds,
    supported_countries,
    supported_payment_methods,
    health_status,
    last_health_check,
    consecutive_failures,
    total_requests,
    successful_requests,
    average_response_time_ms,
    created_at,
    updated_at
) VALUES (
    '11111111-1111-1111-1111-111111111111'::uuid,
    'onramper',
    'Onramper',
    true,
    100,  -- æœ€é«˜ä¼˜å…ˆçº§
    0.5,  -- èšåˆå™¨è´¹ç‡æœ€ä¼˜
    3.5,
    'https://api.onramper.com',
    'https://webhook.onramper.com',
    30,
    ARRAY['US', 'GB', 'EU', 'CA', 'AU', 'JP', 'KR', 'SG', 'HK', 'TW', 'CN', 'IN', 'BR', 'MX', 'RU', 'ZA', 'AE', 'TR', 'ID', 'TH', 'VN', 'PH', 'MY'],
    ARRAY['credit_card', 'debit_card', 'bank_transfer', 'apple_pay', 'google_pay', 'wechat_pay', 'alipay', 'sepa', 'pix', 'upi', 'faster_payments'],
    'healthy',
    NOW(),
    0,
    0,
    0,
    0,
    NOW(),
    NOW()
) ON CONFLICT (id) DO UPDATE SET
    name = EXCLUDED.name,
    display_name = EXCLUDED.display_name,
    priority = EXCLUDED.priority,
    fee_min_percent = EXCLUDED.fee_min_percent,
    fee_max_percent = EXCLUDED.fee_max_percent,
    supported_countries = EXCLUDED.supported_countries,
    supported_payment_methods = EXCLUDED.supported_payment_methods,
    updated_at = NOW();

-- âœ… ä¸»åŠ›2: TransFi - ä¸­å›½ç‰¹åŒ–(ä¼˜å…ˆçº§90)
INSERT INTO fiat.providers (
    id,
    name,
    display_name,
    is_enabled,
    priority,
    fee_min_percent,
    fee_max_percent,
    api_url,
    webhook_url,
    timeout_seconds,
    supported_countries,
    supported_payment_methods,
    health_status,
    last_health_check,
    consecutive_failures,
    total_requests,
    successful_requests,
    average_response_time_ms,
    created_at,
    updated_at
) VALUES (
    '22222222-2222-2222-2222-222222222222'::uuid,
    'transfi',
    'TransFi',
    true,
    90,
    1.5,  -- æ–°å…´å¸‚åœºä½è´¹ç‡
    3.5,
    'https://api.transfi.com',
    'https://webhook.transfi.com',
    30,
    ARRAY['CN', 'HK', 'TW', 'SG', 'MY', 'TH', 'VN', 'ID', 'PH', 'IN', 'BR', 'MX', 'AR', 'TR', 'ZA', 'AE', 'RU'],
    ARRAY['alipay', 'wechat_pay', 'bank_transfer', 'credit_card', 'debit_card', 'pix', 'upi', 'paytm', 'gcash'],
    'healthy',
    NOW(),
    0,
    0,
    0,
    0,
    NOW(),
    NOW()
) ON CONFLICT (id) DO UPDATE SET
    name = EXCLUDED.name,
    display_name = EXCLUDED.display_name,
    priority = EXCLUDED.priority,
    fee_min_percent = EXCLUDED.fee_min_percent,
    fee_max_percent = EXCLUDED.fee_max_percent,
    supported_countries = EXCLUDED.supported_countries,
    supported_payment_methods = EXCLUDED.supported_payment_methods,
    updated_at = NOW();

-- âœ… ä¸»åŠ›3: Alchemy Pay - Web3ä¼˜åŒ–(ä¼˜å…ˆçº§85)
INSERT INTO fiat.providers (
    id,
    name,
    display_name,
    is_enabled,
    priority,
    fee_min_percent,
    fee_max_percent,
    api_url,
    webhook_url,
    timeout_seconds,
    supported_countries,
    supported_payment_methods,
    health_status,
    last_health_check,
    consecutive_failures,
    total_requests,
    successful_requests,
    average_response_time_ms,
    created_at,
    updated_at
) VALUES (
    '33333333-3333-3333-3333-333333333333'::uuid,
    'alchemypay',
    'Alchemy Pay',
    true,
    85,
    2.0,  -- DeFiå‹å¥½è´¹ç‡
    4.0,
    'https://api.alchemypay.org',
    'https://webhook.alchemypay.org',
    30,
    ARRAY['CN', 'US', 'GB', 'EU', 'CA', 'AU', 'JP', 'KR', 'SG', 'HK', 'TW', 'IN', 'TH', 'VN', 'ID', 'PH'],
    ARRAY['alipay', 'wechat_pay', 'credit_card', 'debit_card', 'bank_transfer', 'apple_pay', 'google_pay', 'binance_pay', 'okx_pay'],
    'healthy',
    NOW(),
    0,
    0,
    0,
    0,
    NOW(),
    NOW()
) ON CONFLICT (id) DO UPDATE SET
    name = EXCLUDED.name,
    display_name = EXCLUDED.display_name,
    priority = EXCLUDED.priority,
    fee_min_percent = EXCLUDED.fee_min_percent,
    fee_max_percent = EXCLUDED.fee_max_percent,
    supported_countries = EXCLUDED.supported_countries,
    supported_payment_methods = EXCLUDED.supported_payment_methods,
    updated_at = NOW();

-- âœ… å…œåº•1: Ramp Network - æ¬§ç¾å…œåº•(ä¼˜å…ˆçº§70)
INSERT INTO fiat.providers (
    id,
    name,
    display_name,
    is_enabled,
    priority,
    fee_min_percent,
    fee_max_percent,
    api_url,
    webhook_url,
    timeout_seconds,
    supported_countries,
    supported_payment_methods,
    health_status,
    last_health_check,
    consecutive_failures,
    total_requests,
    successful_requests,
    average_response_time_ms,
    created_at,
    updated_at
) VALUES (
    '44444444-4444-4444-4444-444444444444'::uuid,
    'ramp',
    'Ramp Network',
    true,
    70,  -- é™ä½ä¼˜å…ˆçº§ä½œä¸ºå…œåº•
    0.49,  -- è´¹ç‡æœ€ä½
    2.9,
    'https://api.ramp.network',
    'https://webhook.ramp.network',
    30,
    ARRAY['US', 'GB', 'EU', 'CA', 'AU', 'CH', 'NO', 'SE', 'DK', 'FI', 'NL', 'BE', 'AT', 'IE', 'ES', 'IT', 'PT', 'FR', 'DE'],
    ARRAY['bank_transfer', 'sepa', 'instant_sepa', 'ach', 'open_banking', 'faster_payments'],
    'healthy',
    NOW(),
    0,
    0,
    0,
    0,
    NOW(),
    NOW()
) ON CONFLICT (id) DO UPDATE SET
    name = EXCLUDED.name,
    display_name = EXCLUDED.display_name,
    priority = EXCLUDED.priority,
    fee_min_percent = EXCLUDED.fee_min_percent,
    fee_max_percent = EXCLUDED.fee_max_percent,
    supported_countries = EXCLUDED.supported_countries,
    supported_payment_methods = EXCLUDED.supported_payment_methods,
    updated_at = NOW();

-- âœ… å…œåº•2: MoonPay - å…¨çƒå…œåº•(ä¼˜å…ˆçº§60)
INSERT INTO fiat.providers (
    id,
    name,
    display_name,
    is_enabled,
    priority,
    fee_min_percent,
    fee_max_percent,
    api_url,
    webhook_url,
    timeout_seconds,
    supported_countries,
    supported_payment_methods,
    health_status,
    last_health_check,
    consecutive_failures,
    total_requests,
    successful_requests,
    average_response_time_ms,
    created_at,
    updated_at
) VALUES (
    '55555555-5555-5555-5555-555555555555'::uuid,
    'moonpay',
    'MoonPay',
    true,
    60,  -- æœ€åå…œåº•
    1.0,  -- å“ç‰Œä¿¡ä»»
    4.5,
    'https://api.moonpay.com',
    'https://webhook.moonpay.com',
    30,
    ARRAY['US', 'GB', 'EU', 'CA', 'AU', 'NZ', 'JP', 'KR', 'SG', 'HK', 'TW', 'IN', 'BR', 'MX', 'ZA', 'AE', 'CH', 'NO', 'SE', 'DK', 'FI'],
    ARRAY['credit_card', 'debit_card', 'bank_transfer', 'apple_pay', 'google_pay', 'samsung_pay', 'sepa', 'pix'],
    'healthy',
    NOW(),
    0,
    0,
    0,
    0,
    NOW(),
    NOW()
) ON CONFLICT (id) DO UPDATE SET
    name = EXCLUDED.name,
    display_name = EXCLUDED.display_name,
    priority = EXCLUDED.priority,
    fee_min_percent = EXCLUDED.fee_min_percent,
    fee_max_percent = EXCLUDED.fee_max_percent,
    supported_countries = EXCLUDED.supported_countries,
    supported_payment_methods = EXCLUDED.supported_payment_methods,
    updated_at = NOW();

-- Step 3: éªŒè¯æ•°æ®
DO $$
DECLARE
    provider_count INT;
BEGIN
    SELECT COUNT(*) INTO provider_count FROM fiat.providers WHERE is_enabled = true;
    
    IF provider_count = 5 THEN
        RAISE NOTICE 'âœ… 5æœåŠ¡å•†æ¶æ„å‡çº§å®Œæˆï¼šOnramper(100), TransFi(90), AlchemyPay(85), Ramp(70), MoonPay(60)';
    ELSE
        RAISE WARNING 'âš ï¸ é¢„æœŸ5ä¸ªæœåŠ¡å•†ï¼Œå®é™…: %', provider_count;
    END IF;
END $$;
