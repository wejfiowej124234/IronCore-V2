# IronCore å¿«é€Ÿå¯åŠ¨æŒ‡å—

## ğŸš€ å¿«é€Ÿå¯åŠ¨ï¼ˆæ¨èæ–¹å¼ï¼‰

### æ–¹æ³•1ï¼šä½¿ç”¨ PowerShell è„šæœ¬
```powershell
cd IronCore
.\start-backend.ps1
```

### æ–¹æ³•2ï¼šä½¿ç”¨ Batch è„šæœ¬
```cmd
cd IronCore
start-backend.bat
```

### æ–¹æ³•3ï¼šæ‰‹åŠ¨å¯åŠ¨ï¼ˆGit Bashï¼‰
```bash
cd IronCore
export SKIP_MIGRATIONS=1
cargo run --release --bin ironcore
```

---

## ğŸ“‹ å‰ç½®æ¡ä»¶

### 1. Docker æœåŠ¡å¿…é¡»è¿è¡Œ
- âœ… CockroachDB (ç«¯å£ 26257)
- âœ… Redis (ç«¯å£ 6379)

**å¯åŠ¨ Docker æœåŠ¡ï¼š**
```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
docker compose -f ops/docker-compose.yml up -d cockroach redis
```

### 2. æ•°æ®åº“è¿ç§»å¿…é¡»å®Œæˆ
**æ£€æŸ¥è¿ç§»çŠ¶æ€ï¼š**
```bash
docker exec ironwallet-cockroachdb ./cockroach sql --insecure \
  --execute="SELECT COUNT(*) FROM ironcore._sqlx_migrations;"
```
åº”è¯¥æ˜¾ç¤º **33** ä¸ªè¿ç§»ã€‚

**å¦‚æœéœ€è¦è¿è¡Œè¿ç§»ï¼š**
```bash
cd IronCore
./migrate_sqlx.sh
# é€‰æ‹© 1 (Reset database)
# ç¡®è®¤ yes
```

---

## ğŸŒ æœåŠ¡åœ°å€

å¯åŠ¨æˆåŠŸåè®¿é—®ï¼š

| æœåŠ¡ | åœ°å€ | è¯´æ˜ |
|------|------|------|
| **åç«¯ API** | http://localhost:3012 | RESTful API |
| **Swagger UI** | http://localhost:3012/swagger-ui | API æ–‡æ¡£ |
| **å¥åº·æ£€æŸ¥** | http://localhost:3012/health | æœåŠ¡çŠ¶æ€ |
| **CockroachDB UI** | http://localhost:8090 | æ•°æ®åº“ç®¡ç† |
| **Redis** | localhost:6379 | ç¼“å­˜æœåŠ¡ |

---

## âœ… éªŒè¯åç«¯è¿è¡Œ

### 1. å¥åº·æ£€æŸ¥
```bash
curl http://localhost:3012/health
```

### 2. æŸ¥çœ‹æ—¥å¿—
åç«¯å¯åŠ¨åï¼Œç»ˆç«¯ä¼šæ˜¾ç¤ºï¼š
```
âœ… Database connected
âœ… Redis distributed lock initialized  
âœ… Transaction monitor started
âœ… Transaction auto-recovery started
âœ… Cross-chain event listener started
ğŸ‰ Server listening on http://0.0.0.0:3012
ğŸ“– Swagger UI: http://0.0.0.0:3012/swagger-ui
```

---

## ğŸ› ï¸ æ•…éšœæ’é™¤

### é—®é¢˜1: Redis è¿æ¥å¤±è´¥
**é”™è¯¯ï¼š** `Password authentication failed`

**è§£å†³ï¼š** æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„ Redis å¯†ç æ˜¯å¦æ­£ç¡®
```bash
# å¯†ç åº”è¯¥æ˜¯ï¼š
REDIS_PASSWORD=cdoqUAJuktZ9y9U8tJ31v9hXCnUjxCjLlTxVsh7lavs=
REDIS_URL=redis://:cdoqUAJuktZ9y9U8tJ31v9hXCnUjxCjLlTxVsh7lavs=@localhost:6379/0
```

### é—®é¢˜2: æ•°æ®åº“è¡¨ä¸å­˜åœ¨
**é”™è¯¯ï¼š** `relation "xxx" does not exist`

**è§£å†³ï¼š** é‡æ–°è¿è¡Œæ•°æ®åº“è¿ç§»
```bash
cd IronCore
./migrate_sqlx.sh  # é€‰æ‹© 1
```

### é—®é¢˜3: ç¼–è¯‘é”™è¯¯
**è§£å†³ï¼š** ç¡®ä¿æ‰€æœ‰ä¾èµ–å·²å®‰è£…
```bash
cargo clean
cargo build --release --bin ironcore
```

---

## ğŸ“ ç¯å¢ƒå˜é‡é…ç½®

å…³é”®ç¯å¢ƒå˜é‡ï¼ˆåœ¨ `.env` æ–‡ä»¶ä¸­ï¼‰ï¼š

```env
# æ•°æ®åº“
DATABASE_URL=postgres://root@localhost:26257/ironcore?sslmode=disable

# Redisï¼ˆå¯†ç å¿…é¡»ä¸ docker-compose.yml ä¸€è‡´ï¼‰
REDIS_PASSWORD=cdoqUAJuktZ9y9U8tJ31v9hXCnUjxCjLlTxVsh7lavs=
REDIS_URL=redis://:cdoqUAJuktZ9y9U8tJ31v9hXCnUjxCjLlTxVsh7lavs=@localhost:6379/0

# è·³è¿‡å¯åŠ¨æ—¶è¿ç§»
SKIP_MIGRATIONS=1

# æ—¥å¿—çº§åˆ«
RUST_LOG=info
```

---

## ğŸ¯ å®Œæ•´å¯åŠ¨æµç¨‹

### 1. å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆæ¨èï¼‰
```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
start.bat
```

è¿™å°†å¯åŠ¨ï¼š
- âœ… Docker æœåŠ¡ï¼ˆCockroachDB + Redis + ImmuDBï¼‰
- âœ… åç«¯æœåŠ¡ï¼ˆIronCoreï¼‰
- âœ… å‰ç«¯æœåŠ¡ï¼ˆIronForgeï¼‰

### 2. ä»…å¯åŠ¨åç«¯
```bash
cd IronCore
.\start-backend.ps1   # PowerShell
# æˆ–
start-backend.bat     # CMD
```

---

## ğŸ“Š å½“å‰ç³»ç»ŸçŠ¶æ€

### è¿ç§»çŠ¶æ€
- âœ… **33 ä¸ªè¿ç§»æ–‡ä»¶å…¨éƒ¨æˆåŠŸåº”ç”¨**
- âœ… æ‰€æœ‰ CockroachDB å…¼å®¹æ€§é—®é¢˜å·²ä¿®å¤

### ä»£ç çŠ¶æ€  
- âœ… **ç¼–è¯‘æˆåŠŸ**ï¼ˆ0 errors, 23 warningsï¼‰
- âœ… æ‰€æœ‰ç±»å‹åŒ¹é…é—®é¢˜å·²ä¿®å¤

### Docker å®¹å™¨
- âœ… ironwallet-cockroachdb (è¿è¡Œä¸­)
- âœ… ironwallet-redis (è¿è¡Œä¸­)

---

**ç³»ç»Ÿå·²å°±ç»ªï¼å¯ä»¥ç›´æ¥è¿è¡Œ `start.bat` æˆ–è¿›å…¥ IronCore ç›®å½•è¿è¡Œ `start-backend.ps1`** ğŸ‰

