# IronForge Backend API è·¯ç”±å›¾

## ğŸ“ å®Œæ•´ API ç«¯ç‚¹æ¸…å•ï¼ˆPort 8088ï¼‰

### ğŸŒ å…¬å¼€è·¯ç”±ï¼ˆæ— éœ€è®¤è¯ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å…¬å¼€ API                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ğŸ” è®¤è¯                                                    â”‚
â”‚  â”œâ”€ POST   /api/auth/register        ç”¨æˆ·æ³¨å†Œ               â”‚
â”‚  â”œâ”€ POST   /api/auth/login           ç”¨æˆ·ç™»å½•               â”‚
â”‚  â””â”€ POST   /api/auth/refresh         åˆ·æ–°Token              â”‚
â”‚                                                             â”‚
â”‚  ğŸ’¼ å¤šé“¾é’±åŒ… APIï¼ˆæ–°ç³»ç»Ÿï¼‰â­                                  â”‚
â”‚  â”œâ”€ POST   /api/wallets/unified-create   ç»Ÿä¸€åˆ›å»ºï¼ˆæ¨èï¼‰   â”‚
â”‚  â”œâ”€ POST   /api/wallets/create           çº¯æ´¾ç”Ÿï¼ˆä¸å­˜å‚¨ï¼‰   â”‚
â”‚  â”œâ”€ POST   /api/wallets/create-multi     æ‰¹é‡å¤šé“¾åˆ›å»º       â”‚
â”‚  â”œâ”€ POST   /api/v2/wallets/create        å‰ç«¯å…¼å®¹æ¥å£       â”‚
â”‚  â”œâ”€ GET    /api/chains                   é“¾ä¿¡æ¯åˆ—è¡¨         â”‚
â”‚  â”œâ”€ GET    /api/chains/by-curve          æŒ‰æ›²çº¿åˆ†ç»„         â”‚
â”‚  â””â”€ POST   /api/wallets/validate-address åœ°å€éªŒè¯           â”‚
â”‚                                                             â”‚
â”‚  â¤ï¸ å¥åº·æ£€æŸ¥                                                 â”‚
â”‚  â”œâ”€ GET    /api/health               APIå¥åº·çŠ¶æ€            â”‚
â”‚  â”œâ”€ GET    /healthz                  K8sæ¢é’ˆ                â”‚
â”‚  â”œâ”€ GET    /api/errors               é”™è¯¯æŸ¥è¯¢               â”‚
â”‚  â””â”€ GET    /metrics                  PrometheusæŒ‡æ ‡         â”‚
â”‚                                                             â”‚
â”‚  ğŸ“– æ–‡æ¡£                                                     â”‚
â”‚  â”œâ”€ GET    /openapi.yaml             OpenAPIè§„èŒƒ            â”‚
â”‚  â””â”€ GET    /docs                     Swagger UI             â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ğŸ”’ å—ä¿æŠ¤è·¯ç”±ï¼ˆéœ€è¦ JWT è®¤è¯ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å—ä¿æŠ¤ API                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ğŸ” è®¤è¯ç®¡ç†                                                 â”‚
â”‚  â”œâ”€ POST   /api/auth/logout          ç™»å‡º                   â”‚
â”‚  â”œâ”€ GET    /api/auth/me              å½“å‰ç”¨æˆ·ä¿¡æ¯           â”‚
â”‚  â”œâ”€ POST   /api/auth/set-password    è®¾ç½®å¯†ç                â”‚
â”‚  â”œâ”€ POST   /api/auth/reset-password  é‡ç½®å¯†ç                â”‚
â”‚  â””â”€ GET    /api/auth/login-history   ç™»å½•å†å²               â”‚
â”‚                                                             â”‚
â”‚  ğŸ’° é’±åŒ…ç®¡ç†ï¼ˆç®€åŒ–ç‰ˆï¼‰âš ï¸ åºŸå¼ƒä¸­                               â”‚
â”‚  â”œâ”€ POST   /api/wallets              åˆ›å»ºé’±åŒ…ï¼ˆåºŸå¼ƒï¼‰        â”‚
â”‚  â”œâ”€ GET    /api/wallets              é’±åŒ…åˆ—è¡¨                â”‚
â”‚  â”œâ”€ GET    /api/wallets/:id          é’±åŒ…è¯¦æƒ…                â”‚
â”‚  â””â”€ DELETE /api/wallets/:id          åˆ é™¤é’±åŒ…                â”‚
â”‚                                                             â”‚
â”‚  ğŸ’° é’±åŒ…ç®¡ç†ï¼ˆä¼ä¸šç‰ˆï¼‰âš ï¸ åºŸå¼ƒä¸­                               â”‚
â”‚  â”œâ”€ POST   /api/v1/wallets           åˆ›å»ºé’±åŒ…ï¼ˆåºŸå¼ƒï¼‰        â”‚
â”‚  â”œâ”€ GET    /api/v1/wallets           é’±åŒ…åˆ—è¡¨                â”‚
â”‚  â”œâ”€ GET    /api/v1/wallets/:id       é’±åŒ…è¯¦æƒ…                â”‚
â”‚  â””â”€ DELETE /api/v1/wallets/:id       åˆ é™¤é’±åŒ…                â”‚
â”‚                                                             â”‚
â”‚  ğŸ’¸ äº¤æ˜“ç®¡ç†                                                 â”‚
â”‚  â”œâ”€ POST   /api/transactions/send    å‘é€äº¤æ˜“ï¼ˆç®€åŒ–ï¼‰        â”‚
â”‚  â”œâ”€ GET    /api/transactions         äº¤æ˜“åˆ—è¡¨ï¼ˆç®€åŒ–ï¼‰        â”‚
â”‚  â”œâ”€ POST   /api/v1/tx                åˆ›å»ºäº¤æ˜“                â”‚
â”‚  â”œâ”€ GET    /api/v1/tx                äº¤æ˜“åˆ—è¡¨                â”‚
â”‚  â”œâ”€ GET    /api/v1/tx/:id            äº¤æ˜“è¯¦æƒ…                â”‚
â”‚  â””â”€ PUT    /api/v1/tx/:id/status     æ›´æ–°äº¤æ˜“çŠ¶æ€            â”‚
â”‚                                                             â”‚
â”‚  ğŸ¢ ç§Ÿæˆ·ç®¡ç†                                                 â”‚
â”‚  â”œâ”€ POST   /api/v1/tenants           åˆ›å»ºç§Ÿæˆ·                â”‚
â”‚  â”œâ”€ GET    /api/v1/tenants           ç§Ÿæˆ·åˆ—è¡¨                â”‚
â”‚  â”œâ”€ GET    /api/v1/tenants/:id       ç§Ÿæˆ·è¯¦æƒ…                â”‚
â”‚  â”œâ”€ PUT    /api/v1/tenants/:id       æ›´æ–°ç§Ÿæˆ·                â”‚
â”‚  â””â”€ DELETE /api/v1/tenants/:id       åˆ é™¤ç§Ÿæˆ·                â”‚
â”‚                                                             â”‚
â”‚  ğŸ‘¤ ç”¨æˆ·ç®¡ç†                                                 â”‚
â”‚  â”œâ”€ POST   /api/v1/users             åˆ›å»ºç”¨æˆ·                â”‚
â”‚  â”œâ”€ GET    /api/v1/users             ç”¨æˆ·åˆ—è¡¨                â”‚
â”‚  â”œâ”€ GET    /api/v1/users/:id         ç”¨æˆ·è¯¦æƒ…                â”‚
â”‚  â”œâ”€ PUT    /api/v1/users/:id         æ›´æ–°ç”¨æˆ·                â”‚
â”‚  â””â”€ DELETE /api/v1/users/:id         åˆ é™¤ç”¨æˆ·                â”‚
â”‚                                                             â”‚
â”‚  ğŸ“‹ ç­–ç•¥ç®¡ç†                                                 â”‚
â”‚  â”œâ”€ POST   /api/v1/policies          åˆ›å»ºç­–ç•¥                â”‚
â”‚  â”œâ”€ GET    /api/v1/policies          ç­–ç•¥åˆ—è¡¨                â”‚
â”‚  â”œâ”€ GET    /api/v1/policies/:id      ç­–ç•¥è¯¦æƒ…                â”‚
â”‚  â”œâ”€ PUT    /api/v1/policies/:id      æ›´æ–°ç­–ç•¥                â”‚
â”‚  â””â”€ DELETE /api/v1/policies/:id      åˆ é™¤ç­–ç•¥                â”‚
â”‚                                                             â”‚
â”‚  âœ… å®¡æ‰¹ç®¡ç†                                                 â”‚
â”‚  â”œâ”€ POST   /api/v1/approvals         åˆ›å»ºå®¡æ‰¹                â”‚
â”‚  â”œâ”€ GET    /api/v1/approvals         å®¡æ‰¹åˆ—è¡¨                â”‚
â”‚  â”œâ”€ GET    /api/v1/approvals/:id     å®¡æ‰¹è¯¦æƒ…                â”‚
â”‚  â”œâ”€ PUT    /api/v1/approvals/:id/status  æ›´æ–°å®¡æ‰¹çŠ¶æ€       â”‚
â”‚  â””â”€ DELETE /api/v1/approvals/:id     åˆ é™¤å®¡æ‰¹                â”‚
â”‚                                                             â”‚
â”‚  ğŸ”‘ API å¯†é’¥ç®¡ç†                                             â”‚
â”‚  â”œâ”€ POST   /api/v1/api-keys          åˆ›å»ºAPIå¯†é’¥             â”‚
â”‚  â”œâ”€ GET    /api/v1/api-keys          APIå¯†é’¥åˆ—è¡¨             â”‚
â”‚  â”œâ”€ GET    /api/v1/api-keys/:id      APIå¯†é’¥è¯¦æƒ…             â”‚
â”‚  â”œâ”€ PUT    /api/v1/api-keys/:id/status  æ›´æ–°å¯†é’¥çŠ¶æ€        â”‚
â”‚  â””â”€ DELETE /api/v1/api-keys/:id      åˆ é™¤APIå¯†é’¥             â”‚
â”‚                                                             â”‚
â”‚  ğŸ“¡ äº¤æ˜“å¹¿æ’­                                                 â”‚
â”‚  â”œâ”€ POST   /api/v1/tx-broadcasts     åˆ›å»ºäº¤æ˜“å¹¿æ’­            â”‚
â”‚  â”œâ”€ GET    /api/v1/tx-broadcasts     å¹¿æ’­åˆ—è¡¨                â”‚
â”‚  â”œâ”€ GET    /api/v1/tx-broadcasts/:id å¹¿æ’­è¯¦æƒ…                â”‚
â”‚  â”œâ”€ PUT    /api/v1/tx-broadcasts/:id æ›´æ–°å¹¿æ’­                â”‚
â”‚  â””â”€ GET    /api/v1/tx-broadcasts/by-tx-hash/:hash æŒ‰å“ˆå¸ŒæŸ¥è¯¢â”‚
â”‚                                                             â”‚
â”‚  â›½ åŒºå—é“¾æŸ¥è¯¢                                               â”‚
â”‚  â”œâ”€ GET    /api/fees                 Gasè´¹ç”¨æŸ¥è¯¢             â”‚
â”‚  â”œâ”€ GET    /api/gas/estimate-all     Gasä¼°ç®—ï¼ˆæ‰€æœ‰æ¡£ä½ï¼‰      â”‚
â”‚  â”œâ”€ GET    /api/network/status       ç½‘ç»œçŠ¶æ€                â”‚
â”‚  â””â”€ GET    /balance                  ä½™é¢æŸ¥è¯¢                â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ API ä½¿ç”¨å»ºè®®

### âœ… æ¨èä½¿ç”¨

#### å¤šé“¾é’±åŒ…åˆ›å»º
```bash
# 1. ç»Ÿä¸€åˆ›å»ºï¼ˆæœ€æ¨èï¼‰â­
POST /api/wallets/unified-create
{
  "name": "My Wallet",
  "chain": "eth"
}

# 2. å‰ç«¯å…¼å®¹æ¥å£
POST /api/v2/wallets/create
{
  "name": "My Wallet",
  "address": "0x...",
  "chain": "ethereum"
}

# 3. çº¯æ´¾ç”Ÿï¼ˆé«˜çº§ç”¨æˆ·ï¼‰
POST /api/wallets/create
{
  "chain": "sol",
  "mnemonic": "word1 word2..."
}
```

#### é’±åŒ…æŸ¥è¯¢
```bash
# åˆ—è¡¨
GET /api/wallets
Authorization: Bearer <token>

# è¯¦æƒ…
GET /api/wallets/{id}
Authorization: Bearer <token>
```

---

### âš ï¸ åºŸå¼ƒä½†å¯ç”¨ï¼ˆéœ€è¿ç§»ï¼‰

```bash
# ç®€åŒ–ç‰ˆï¼ˆå°†åœ¨ 2025-12-08 åˆ é™¤ï¼‰
POST /api/wallets
{
  "name": "My Wallet",
  "address": "0x...",
  "chain": "ethereum"
}

# ä¼ä¸šç‰ˆï¼ˆå°†åœ¨ 2025-12-08 åˆ é™¤ï¼‰
POST /api/v1/wallets
{
  "tenant_id": "uuid",
  "user_id": "uuid",
  "chain_id": 1,
  "address": "0x...",
  "pubkey": "0x..."
}
```

**è¿ç§»æŒ‡å—**: è¯·ä½¿ç”¨ `POST /api/wallets/unified-create` æ›¿ä»£

---

## ğŸ“Š ç«¯ç‚¹ç»Ÿè®¡

### æ€»è®¡
- **å…¬å¼€ç«¯ç‚¹**: 15 ä¸ª
- **å—ä¿æŠ¤ç«¯ç‚¹**: 57 ä¸ª
- **æ€»è®¡**: 72 ä¸ª

### åˆ†ç±»ç»Ÿè®¡
| åˆ†ç±» | ç«¯ç‚¹æ•°é‡ | çŠ¶æ€ |
|------|---------|------|
| å¤šé“¾é’±åŒ…ï¼ˆæ–°ï¼‰ | 7 | âœ… æ´»è·ƒ |
| é’±åŒ…ç®¡ç†ï¼ˆæ—§ï¼‰ | 8 | âš ï¸ åºŸå¼ƒä¸­ |
| è®¤è¯ç®¡ç† | 8 | âœ… æ´»è·ƒ |
| äº¤æ˜“ç®¡ç† | 6 | âœ… æ´»è·ƒ |
| ç§Ÿæˆ·ç®¡ç† | 5 | ğŸŸ¡ å¯é€‰ |
| ç”¨æˆ·ç®¡ç† | 5 | ğŸŸ¡ å¯é€‰ |
| ç­–ç•¥ç®¡ç† | 5 | ğŸŸ¡ å¯é€‰ |
| å®¡æ‰¹ç®¡ç† | 5 | ğŸŸ¡ å¯é€‰ |
| APIå¯†é’¥ç®¡ç† | 5 | ğŸŸ¡ å¯é€‰ |
| äº¤æ˜“å¹¿æ’­ | 5 | ğŸŸ¡ å¯é€‰ |
| åŒºå—é“¾æŸ¥è¯¢ | 4 | âœ… æ´»è·ƒ |
| å¥åº·æ£€æŸ¥ | 4 | âœ… æ´»è·ƒ |
| æ–‡æ¡£ | 2 | âœ… æ´»è·ƒ |

---

## ğŸ”„ ä¸­é—´ä»¶æ ˆ

### å…¬å¼€è·¯ç”±ä¸­é—´ä»¶
```
Request
  â†“
1. set_request_id           # ç”Ÿæˆè¯·æ±‚ID
  â†“
2. trace_log                # æ—¥å¿—è¿½è¸ª
  â†“
3. add_response_time_header # å“åº”æ—¶é—´
  â†“
4. add_cors_headers         # CORSæ”¯æŒ
  â†“
Handler
  â†“
Response
```

### å—ä¿æŠ¤è·¯ç”±ä¸­é—´ä»¶
```
Request
  â†“
1. set_request_id           # ç”Ÿæˆè¯·æ±‚ID
  â†“
2. trace_log                # æ—¥å¿—è¿½è¸ª
  â†“
3. add_response_time_header # å“åº”æ—¶é—´
  â†“
4. add_cors_headers         # CORSæ”¯æŒ
  â†“
5. add_api_version_header   # APIç‰ˆæœ¬
  â†“
6. add_security_headers     # å®‰å…¨å¤´
  â†“
7. auth_middleware          # JWTéªŒè¯ âš ï¸
  â†“
8. rate_limit_middleware    # é€Ÿç‡é™åˆ¶
  â†“
9. idempotency_middleware   # å¹‚ç­‰æ€§æ£€æŸ¥
  â†“
Handler
  â†“
Response
```

---

## ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

### 1. è®¤è¯
- JWT Token è®¤è¯
- Token è¿‡æœŸæ—¶é—´: 1 å°æ—¶
- Refresh Token æ”¯æŒ

### 2. CORS
- å…è®¸æ¥æº: å¯é…ç½®ï¼ˆé»˜è®¤ `*`ï¼‰
- å…è®¸æ–¹æ³•: GET, POST, PUT, DELETE, OPTIONS
- å…è®¸å¤´: Content-Type, Authorization, Idempotency-Key, X-Request-Id

### 3. å®‰å…¨å¤´
- `X-Content-Type-Options: nosniff`
- `X-Frame-Options: DENY`
- `Referrer-Policy: no-referrer`
- `Cache-Control: no-store`
- `Content-Security-Policy: default-src 'self'`
- `Strict-Transport-Security: max-age=31536000` (HTTPS)

### 4. é€Ÿç‡é™åˆ¶
- é»˜è®¤: 100 è¯·æ±‚/åˆ†é’Ÿ/IP
- å¯é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®

### 5. å¹‚ç­‰æ€§
- æ”¯æŒ `Idempotency-Key` å¤´
- é˜²æ­¢é‡å¤è¯·æ±‚

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### å“åº”æ—¶é—´ï¼ˆP95ï¼‰
| ç«¯ç‚¹ç±»å‹ | å“åº”æ—¶é—´ |
|---------|---------|
| å¥åº·æ£€æŸ¥ | < 1ms |
| é“¾åˆ—è¡¨æŸ¥è¯¢ | < 1ms |
| é’±åŒ…æ´¾ç”Ÿ | 13ms |
| ç»Ÿä¸€åˆ›å»º | 22-33ms |
| æ•°æ®åº“æŸ¥è¯¢ | 5-10ms |

### ååé‡
- å¥åº·æ£€æŸ¥: ~10,000 req/s
- é’±åŒ…åˆ›å»º: ~500 req/s
- æ•°æ®åº“å†™å…¥: ~200 req/s

---

## ğŸ”§ é…ç½®

### ç¯å¢ƒå˜é‡
```bash
# æœåŠ¡å™¨
BIND_ADDR=0.0.0.0:8088

# æ•°æ®åº“
DATABASE_URL=postgres://root@localhost:26257/ironcore

# Redis
REDIS_URL=redis://localhost:6379

# JWT
JWT_SECRET=<your-secret>
TOKEN_EXPIRY_SECS=3600

# CORS
CORS_ALLOW_ORIGINS=*

# å®‰å…¨
HSTS_ENABLE=1  # ä»…åœ¨ HTTPS æ—¶å¯ç”¨
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [API æ¸…ç†åˆ†æ](./API_CLEANUP_ANALYSIS.md)
- [API æ¸…ç†æ€»ç»“](./API_CLEANUP_SUMMARY.md)
- [å¤šé“¾é’±åŒ…æ¶æ„](./MULTI_CHAIN_WALLET_ARCHITECTURE.md)
- [é›†æˆå®ŒæˆæŠ¥å‘Š](./INTEGRATION_COMPLETE_REPORT.md)

---

**æœ€åæ›´æ–°**: 2025-11-23  
**API ç‰ˆæœ¬**: v1  
**åç«¯ç‰ˆæœ¬**: v0.1.0
