# å¤šé“¾é’±åŒ…é›†æˆå®ŒæˆæŠ¥å‘Š

## âœ… é›†æˆæ¦‚è§ˆ

æˆåŠŸå°†**æ–°çš„å¤šé“¾åŠ å¯†æ´¾ç”Ÿç³»ç»Ÿ**ä¸**æ•°æ®åº“å­˜å‚¨å±‚**å®Œå…¨æ•´åˆï¼Œå®ç°äº†ä»å®¢æˆ·ç«¯æ´¾ç”Ÿåˆ°åç«¯æŒä¹…åŒ–çš„å®Œæ•´æµç¨‹ã€‚

### é›†æˆæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å®¢æˆ·ç«¯ï¼ˆIronForgeï¼‰                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  1. ç”Ÿæˆ/å¯¼å…¥åŠ©è®°è¯                                    â”‚  â”‚
â”‚  â”‚  2. æœ¬åœ°åŠ å¯†å­˜å‚¨ï¼ˆIndexedDBï¼‰                          â”‚  â”‚
â”‚  â”‚  3. è°ƒç”¨åç«¯ API åŒæ­¥å…ƒæ•°æ®                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“ HTTP POST
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                åç«¯ï¼ˆBackend - Port 8088ï¼‰                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ç»Ÿä¸€é’±åŒ…åˆ›å»º API                                      â”‚  â”‚
â”‚  â”‚  â”œâ”€ /api/wallets/unified-create (æ¨è)                â”‚  â”‚
â”‚  â”‚  â”œâ”€ /api/v2/wallets/create (å‰ç«¯å…¼å®¹)                 â”‚  â”‚
â”‚  â”‚  â””â”€ /api/wallets/create (çº¯æ´¾ç”Ÿï¼Œä¸å­˜å‚¨)              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â†“                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  å¤šé“¾æ´¾ç”Ÿå±‚ï¼ˆdomain/ï¼‰                                 â”‚  â”‚
â”‚  â”‚  â”œâ”€ chain_config.rs (8æ¡é“¾é…ç½®)                       â”‚  â”‚
â”‚  â”‚  â”œâ”€ derivation.rs (Secp256k1/Ed25519ç­–ç•¥)            â”‚  â”‚
â”‚  â”‚  â””â”€ multi_chain_wallet.rs (ç»Ÿä¸€æœåŠ¡)                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â†“                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  æœåŠ¡å±‚ï¼ˆservice/wallets.rsï¼‰                          â”‚  â”‚
â”‚  â”‚  â””â”€ create_wallet_with_metadata()                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â†“                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  æ•°æ®è®¿é—®å±‚ï¼ˆrepository/wallets.rsï¼‰                   â”‚  â”‚
â”‚  â”‚  â””â”€ INSERT INTO wallets (æ‰©å±•å­—æ®µ)                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                CockroachDB (Port 26257)                     â”‚
â”‚  wallets è¡¨ç»“æ„ï¼š                                            â”‚
â”‚  â”œâ”€ id, tenant_id, user_id (åŸºç¡€å­—æ®µ)                       â”‚
â”‚  â”œâ”€ chain_id, address, pubkey (é“¾ä¿¡æ¯)                     â”‚
â”‚  â”œâ”€ name, derivation_path (æ–°å¢)                           â”‚
â”‚  â”œâ”€ curve_type, chain_symbol (æ–°å¢)                        â”‚
â”‚  â””â”€ account_index, address_index (æ–°å¢)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ æ–‡ä»¶å˜æ›´æ¸…å•

### 1. æ•°æ®åº“è¿ç§»
**æ–‡ä»¶**: `backend/migrations/0004_multi_chain_wallets.sql`
- âœ… æ–°å¢ 6 ä¸ªå­—æ®µï¼šname, derivation_path, curve_type, chain_symbol, account_index, address_index
- âœ… åˆ›å»ºä¼˜åŒ–ç´¢å¼•ï¼šidx_wallets_user_chain, idx_wallets_curve_type, idx_wallets_derivation
- âœ… å·²åº”ç”¨åˆ°æ•°æ®åº“ï¼ˆApplied 4/migrate multi chain walletsï¼‰

### 2. Repository å±‚
**æ–‡ä»¶**: `backend/src/repository/wallets.rs`
- âœ… æ‰©å±• `Wallet` ç»“æ„ä½“ï¼ˆæ–°å¢ 6 ä¸ªOptionå­—æ®µï¼‰
- âœ… æ‰©å±• `CreateWalletInput` ç»“æ„ä½“
- âœ… æ›´æ–° `create()` å‡½æ•°çš„ SQLï¼ˆINSERT 12 ä¸ªå­—æ®µï¼ŒRETURNING 14 ä¸ªå­—æ®µï¼‰
- âœ… å­—æ®µç±»å‹ï¼šaccount_index/address_index ä½¿ç”¨ `Option<i64>`ï¼ˆåŒ¹é…æ•°æ®åº“ INT8ï¼‰

### 3. Service å±‚
**æ–‡ä»¶**: `backend/src/service/wallets.rs`
- âœ… ä¿ç•™åŸ `create_wallet()` å‘åå…¼å®¹
- âœ… æ–°å¢ `create_wallet_with_metadata()` æ”¯æŒå¤šé“¾å‚æ•°
- âœ… å‚æ•°ç­¾åï¼š
  ```rust
  pub async fn create_wallet_with_metadata(
      pool: &PgPool,
      tenant_id: Uuid,
      user_id: Uuid,
      chain_id: i64,
      address: String,
      pubkey: String,
      policy_id: Option<Uuid>,
      name: Option<String>,
      derivation_path: Option<String>,
      curve_type: Option<String>,
      chain_symbol: Option<String>,
      account_index: Option<i64>,
      address_index: Option<i64>,
  ) -> Result<Wallet, anyhow::Error>
  ```

### 4. API å±‚
**æ–‡ä»¶**: `backend/src/api/multi_chain_api.rs`
- âœ… æ–°å¢ `UnifiedCreateWalletRequest` / `UnifiedCreateWalletResponse` ç»“æ„
- âœ… æ–°å¢ `unified_create_wallet()` å¤„ç†å™¨ï¼ˆæ´¾ç”Ÿ + å­˜å‚¨ï¼‰
- âœ… æ–°å¢ `FrontendCreateWalletRequest` / `FrontendWalletResponse`
- âœ… æ–°å¢ `frontend_create_wallet()` å¤„ç†å™¨ï¼ˆå…¼å®¹å‰ç«¯ç°æœ‰è°ƒç”¨ï¼‰
- âœ… è·¯ç”±ï¼š
  - `POST /api/wallets/unified-create` - ç»Ÿä¸€åˆ›å»ºï¼ˆæ¨èï¼‰
  - `POST /api/v2/wallets/create` - å‰ç«¯å…¼å®¹
  - `POST /api/wallets/create` - çº¯æ´¾ç”Ÿï¼ˆä¸å­˜å‚¨ï¼‰
  - `POST /api/wallets/create-multi` - æ‰¹é‡å¤šé“¾æ´¾ç”Ÿ
  - `GET /api/chains` - é“¾åˆ—è¡¨
  - `GET /api/chains/by-curve` - æŒ‰æ›²çº¿åˆ†ç»„
  - `POST /api/wallets/validate-address` - åœ°å€éªŒè¯

### 5. åˆå§‹æ•°æ®
**SQLå‘½ä»¤**: é€šè¿‡ docker exec æ‰§è¡Œ
- âœ… åˆ›å»ºé»˜è®¤ç§Ÿæˆ·ï¼š`00000000-0000-0000-0000-000000000001` (Default Tenant)
- âœ… åˆ›å»ºé»˜è®¤ç”¨æˆ·ï¼š`00000000-0000-0000-0000-000000000001` (default@ironforge.com)

---

## ğŸ§ª æµ‹è¯•ç»“æœ

### æµ‹è¯• 1: ç»Ÿä¸€é’±åŒ…åˆ›å»º API
```bash
curl -X POST http://localhost:8088/api/wallets/unified-create \
  -H "Content-Type: application/json" \
  -d '{"name":"Test Wallet 2","chain":"eth"}'
```

**å“åº”** (200 OK):
```json
{
  "success": true,
  "message": "é’±åŒ…åˆ›å»ºæˆåŠŸ",
  "wallet": {
    "id": "2fcaa2ff-3f0e-4dcf-9bbd-4aaf926b0e4f",
    "name": "Test Wallet 2",
    "address": "0xadb77aac0abdfa12abff4bc648df83bdea2efe3c",
    "public_key": "bf06ac3e510fff124c480cc36011e5f7c96e192496f12c4b5fe4bfcec2b66eebe7b41619211cde7f6ca6b332a4790b269de1025ff4cc0dec5e2265df0c77d382",
    "chain_id": 11155111,
    "chain_symbol": "ETH",
    "curve_type": "Secp256k1",
    "derivation_path": "m/44'/60'/0'/0/0",
    "created_at": "2025-11-23T02:10:14.921835+00:00"
  },
  "mnemonic": "shrimp champion spend lecture split tomorrow range glare height boat history intact"
}
```

âœ… **éªŒè¯ç‚¹**:
- åŠ©è®°è¯è‡ªåŠ¨ç”Ÿæˆï¼ˆ12è¯ï¼‰
- åœ°å€æ­£ç¡®æ´¾ç”Ÿï¼ˆEthereum Sepolia, chain_id=11155111ï¼‰
- å…¬é’¥ã€æ´¾ç”Ÿè·¯å¾„å®Œæ•´
- æ•°æ®åº“å­˜å‚¨æˆåŠŸï¼ˆè¿”å›UUIDï¼‰
- å“åº”æ—¶é—´: 22ms

### æµ‹è¯• 2: é“¾åˆ—è¡¨æŸ¥è¯¢
```bash
curl http://localhost:8088/api/chains
```

**å“åº”** (200 OK):
```json
{
  "total": 8,
  "chains": [
    {"chain_id": 1, "name": "Ethereum", "symbol": "ETH", "curve_type": "Secp256k1"},
    {"chain_id": 11155111, "name": "Ethereum Sepolia", "symbol": "ETH", "curve_type": "Secp256k1"},
    {"chain_id": 56, "name": "BNB Smart Chain", "symbol": "BNB", "curve_type": "Secp256k1"},
    {"chain_id": 137, "name": "Polygon", "symbol": "MATIC", "curve_type": "Secp256k1"},
    {"chain_id": 0, "name": "Bitcoin", "symbol": "BTC", "curve_type": "Secp256k1"},
    {"chain_id": 501, "name": "Solana", "symbol": "SOL", "curve_type": "Ed25519"},
    {"chain_id": 1815, "name": "Cardano", "symbol": "ADA", "curve_type": "Ed25519"},
    {"chain_id": 354, "name": "Polkadot", "symbol": "DOT", "curve_type": "Sr25519"}
  ]
}
```

âœ… **æ”¯æŒçš„é“¾**:
- Secp256k1: ETH, BSC, Polygon, BTC (5æ¡é“¾)
- Ed25519: Solana, Cardano (2æ¡é“¾)
- Sr25519: Polkadot (1æ¡é“¾)

### æµ‹è¯• 3: åŸå§‹æ´¾ç”Ÿ APIï¼ˆä¸å­˜å‚¨ï¼‰
```bash
curl -X POST http://localhost:8088/api/wallets/create \
  -H "Content-Type: application/json" \
  -d '{"chain":"eth"}'
```

**å“åº”** (200 OK):
```json
{
  "chain": {
    "chain_id": 11155111,
    "name": "Ethereum Sepolia",
    "symbol": "ETH",
    "curve_type": "Secp256k1"
  },
  "mnemonic": "nephew tiger shine safe east salon black provide try blade monster deer",
  "wallet": {
    "address": "0x0268e5eacf7fd688a02d2b2368bd4309593ec59b",
    "public_key": "2c9b5fd10f6b005cb60fc73bfb14927ed25d2d451a2eb19ce798eb9987fb3cfd...",
    "derivation_path": "m/44'/60'/0'/0/0"
  }
}
```

âœ… **ç‰¹ç‚¹**: çº¯æ´¾ç”Ÿï¼Œä¸å­˜å‚¨åˆ°æ•°æ®åº“ï¼Œé€‚åˆä¸´æ—¶é’±åŒ…ç”Ÿæˆ

---

## ğŸ”Œ API æ¥å£æ–‡æ¡£

### 1. ç»Ÿä¸€é’±åŒ…åˆ›å»ºï¼ˆæ¨èï¼‰
**ç«¯ç‚¹**: `POST /api/wallets/unified-create`

**è¯·æ±‚ä½“**:
```json
{
  "name": "My Wallet Name",        // å¿…éœ€ï¼šé’±åŒ…åç§°
  "chain": "eth",                  // å¿…éœ€ï¼šé“¾æ ‡è¯†ï¼ˆå°å†™symbolæˆ–chain_idï¼‰
  "mnemonic": "word1 word2...",    // å¯é€‰ï¼šå¯¼å…¥åŠ©è®°è¯ï¼ˆä¸æä¾›åˆ™ç”Ÿæˆï¼‰
  "word_count": 12,                // å¯é€‰ï¼š12æˆ–24ï¼ˆé»˜è®¤12ï¼‰
  "account": 0,                    // å¯é€‰ï¼šBIP44è´¦æˆ·ç´¢å¼•ï¼ˆé»˜è®¤0ï¼‰
  "index": 0,                      // å¯é€‰ï¼šBIP44åœ°å€ç´¢å¼•ï¼ˆé»˜è®¤0ï¼‰
  "tenant_id": "uuid",             // å¯é€‰ï¼šç§Ÿæˆ·IDï¼ˆé»˜è®¤ä½¿ç”¨é»˜è®¤ç§Ÿæˆ·ï¼‰
  "user_id": "uuid"                // å¯é€‰ï¼šç”¨æˆ·IDï¼ˆé»˜è®¤ä½¿ç”¨é»˜è®¤ç”¨æˆ·ï¼‰
}
```

**å“åº”**:
```json
{
  "success": true,
  "message": "é’±åŒ…åˆ›å»ºæˆåŠŸ",
  "wallet": {
    "id": "uuid",
    "name": "My Wallet Name",
    "address": "0x...",
    "public_key": "hex...",
    "chain_id": 11155111,
    "chain_symbol": "ETH",
    "curve_type": "Secp256k1",
    "derivation_path": "m/44'/60'/0'/0/0",
    "created_at": "2025-11-23T..."
  },
  "mnemonic": "word1 word2..."  // ä»…åœ¨ç”Ÿæˆæ–°åŠ©è®°è¯æ—¶è¿”å›
}
```

**æ”¯æŒçš„ chain å€¼**:
- `"eth"` / `"1"` - Ethereum Mainnet
- `"eth"` / `"11155111"` - Ethereum Sepolia (æµ‹è¯•ç½‘)
- `"bnb"` / `"56"` - BSC
- `"matic"` / `"137"` - Polygon
- `"btc"` / `"0"` - Bitcoin
- `"sol"` / `"501"` - Solana
- `"ada"` / `"1815"` - Cardano
- `"dot"` / `"354"` - Polkadot

### 2. å‰ç«¯å…¼å®¹ API
**ç«¯ç‚¹**: `POST /api/v2/wallets/create`

**è¯·æ±‚ä½“**:
```json
{
  "name": "My Wallet",
  "address": "0x...",      // å‰ç«¯å·²æ´¾ç”Ÿçš„åœ°å€
  "chain": "ethereum"      // é“¾åç§°
}
```

**å“åº”**:
```json
{
  "id": "uuid",
  "name": "My Wallet",
  "address": "0x...",
  "chain": "ethereum",
  "balance": "0",
  "created_at": "2025-11-23T..."
}
```

### 3. çº¯æ´¾ç”Ÿ APIï¼ˆä¸å­˜å‚¨ï¼‰
**ç«¯ç‚¹**: `POST /api/wallets/create`

**è¯·æ±‚ä½“**: åŒç»Ÿä¸€åˆ›å»ºAPIï¼ˆä¸éœ€è¦nameï¼‰

**å“åº”**: åªè¿”å›æ´¾ç”Ÿç»“æœï¼Œä¸åŒ…å«æ•°æ®åº“ID

### 4. é“¾ä¿¡æ¯æŸ¥è¯¢
**ç«¯ç‚¹**: `GET /api/chains`

**å“åº”**:
```json
{
  "total": 8,
  "chains": [
    {"chain_id": 1, "name": "Ethereum", "symbol": "ETH", "curve_type": "Secp256k1"},
    ...
  ]
}
```

### 5. æŒ‰æ›²çº¿åˆ†ç»„æŸ¥è¯¢
**ç«¯ç‚¹**: `GET /api/chains/by-curve`

**å“åº”**:
```json
{
  "Secp256k1": [
    {"chain_id": 1, "name": "Ethereum", ...},
    ...
  ],
  "Ed25519": [...],
  "Sr25519": [...]
}
```

---

## ğŸ¯ å‰ç«¯é›†æˆæŒ‡å—

### æ–¹æ¡ˆ 1: ä½¿ç”¨ç»Ÿä¸€ APIï¼ˆæ¨èï¼‰
å‰ç«¯åªéœ€è°ƒç”¨ä¸€ä¸ªæ¥å£å®Œæˆæ‰€æœ‰æ“ä½œï¼š

```typescript
// åˆ›å»ºæ–°é’±åŒ…ï¼ˆè‡ªåŠ¨ç”ŸæˆåŠ©è®°è¯ + æ´¾ç”Ÿ + å­˜å‚¨ï¼‰
const response = await fetch('http://localhost:8088/api/wallets/unified-create', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    name: 'æˆ‘çš„ä»¥å¤ªåŠé’±åŒ…',
    chain: 'eth'  // å°å†™symbol
  })
});

const data = await response.json();
console.log('é’±åŒ…åœ°å€:', data.wallet.address);
console.log('åŠ©è®°è¯:', data.mnemonic);  // âš ï¸ éœ€è¦åŠ å¯†å­˜å‚¨åˆ° IndexedDB
console.log('æ•°æ®åº“ID:', data.wallet.id);
```

### æ–¹æ¡ˆ 2: ä¿æŒç°æœ‰æµç¨‹ï¼ˆå‰ç«¯æ´¾ç”Ÿ + åç«¯å­˜å‚¨ï¼‰
```typescript
// 1. å‰ç«¯æ´¾ç”Ÿåœ°å€ï¼ˆç°æœ‰é€»è¾‘ï¼‰
const mnemonic = generateMnemonic();
const address = deriveEthAddress(mnemonic);

// 2. åŠ å¯†å­˜å‚¨åˆ° IndexedDB
await WalletStorage.save_wallet({
  id: generateId(),
  name: 'æˆ‘çš„é’±åŒ…',
  encrypted_mnemonic: encrypt(mnemonic, password),
  address: address,
  created_at: Date.now()
});

// 3. åŒæ­¥å…ƒæ•°æ®åˆ°åç«¯
await fetch('http://localhost:8088/api/v2/wallets/create', {
  method: 'POST',
  headers: { 
    'Content-Type': 'application/json',
    'Authorization': token  // å¦‚æœéœ€è¦è®¤è¯
  },
  body: JSON.stringify({
    name: 'æˆ‘çš„é’±åŒ…',
    address: address,
    chain: 'ethereum'
  })
});
```

### æ–¹æ¡ˆ 3: æ··åˆæ¨¡å¼ï¼ˆæ¨èç”¨äºå¯¼å…¥ï¼‰
```typescript
// ç”¨æˆ·å¯¼å…¥åŠ©è®°è¯
const userMnemonic = 'ç”¨æˆ·è¾“å…¥çš„12ä¸ªå•è¯';

// è°ƒç”¨åç«¯æ´¾ç”Ÿ + å­˜å‚¨ï¼ˆå¤ç”¨åŠ©è®°è¯ï¼‰
const response = await fetch('http://localhost:8088/api/wallets/unified-create', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    name: 'å¯¼å…¥çš„é’±åŒ…',
    chain: 'eth',
    mnemonic: userMnemonic  // æä¾›åŠ©è®°è¯
  })
});

// åç«¯ä¸ä¼šè¿”å› mnemonicï¼ˆå› ä¸ºæ˜¯å¯¼å…¥çš„ï¼‰
// å‰ç«¯éœ€è¦è‡ªå·±åŠ å¯†å­˜å‚¨ userMnemonic
```

---

## ğŸ“Š æ•°æ®åº“è¡¨ç»“æ„

### wallets è¡¨ï¼ˆæ‰©å±•åï¼‰
```sql
CREATE TABLE wallets (
  -- åŸæœ‰å­—æ®µ
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  tenant_id UUID NOT NULL REFERENCES tenants(id),
  user_id UUID NOT NULL REFERENCES users(id),
  chain_id INT NOT NULL,
  address STRING NOT NULL,
  pubkey TEXT NOT NULL,
  policy_id UUID,
  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),
  
  -- æ–°å¢å­—æ®µï¼ˆå¤šé“¾æ”¯æŒï¼‰
  name STRING,                    -- é’±åŒ…åç§°
  derivation_path STRING,         -- BIP44è·¯å¾„ï¼šm/44'/60'/0'/0/0
  curve_type STRING,              -- æ›²çº¿ç±»å‹ï¼šSecp256k1/Ed25519/Sr25519
  chain_symbol STRING,            -- é“¾ç¬¦å·ï¼šETH/BTC/SOLç­‰
  account_index INT,              -- BIP44è´¦æˆ·ç´¢å¼•
  address_index INT               -- BIP44åœ°å€ç´¢å¼•
);

-- ç´¢å¼•
CREATE INDEX idx_wallets_tenant_chain_addr ON wallets (tenant_id, chain_id, address);
CREATE INDEX idx_wallets_user_chain ON wallets (user_id, chain_id);
CREATE INDEX idx_wallets_curve_type ON wallets (curve_type, chain_id);
CREATE INDEX idx_wallets_derivation ON wallets (derivation_path);
```

### æŸ¥è¯¢ç¤ºä¾‹
```sql
-- æŸ¥è¯¢ç”¨æˆ·çš„æ‰€æœ‰ä»¥å¤ªåŠé’±åŒ…
SELECT * FROM wallets 
WHERE user_id = '...' AND chain_symbol = 'ETH';

-- æŸ¥è¯¢ä½¿ç”¨ Secp256k1 æ›²çº¿çš„æ‰€æœ‰é’±åŒ…
SELECT * FROM wallets 
WHERE curve_type = 'Secp256k1';

-- æŸ¥è¯¢ç‰¹å®šæ´¾ç”Ÿè·¯å¾„çš„é’±åŒ…
SELECT * FROM wallets 
WHERE derivation_path LIKE 'm/44''/60''/0''/0/%';
```

---

## ğŸ”’ å®‰å…¨æ³¨æ„äº‹é¡¹

### âš ï¸ å…³é”®åŸåˆ™
1. **åŠ©è®°è¯/ç§é’¥æ°¸è¿œä¸å­˜å‚¨åˆ°åç«¯æ•°æ®åº“**
2. åç«¯åªå­˜å‚¨ï¼šåœ°å€ã€å…¬é’¥ã€æ´¾ç”Ÿè·¯å¾„ç­‰å…ƒæ•°æ®
3. åŠ©è®°è¯åŠ å¯†åå­˜å‚¨åœ¨å®¢æˆ·ç«¯ï¼ˆIndexedDB/Keychainï¼‰

### ğŸ” æ•°æ®æµå®‰å…¨
```
ç”¨æˆ·è¾“å…¥å¯†ç 
    â†“
å‰ç«¯åŠ å¯†åŠ©è®°è¯ï¼ˆAES-256-GCM + Argon2idï¼‰
    â†“
åŠ å¯†æ•°æ®å­˜å‚¨åˆ° IndexedDB
    â†“
æ˜æ–‡åœ°å€/å…¬é’¥å‘é€åˆ°åç«¯
    â†“
åç«¯å­˜å‚¨å…ƒæ•°æ®åˆ°æ•°æ®åº“
```

### âœ… åç«¯å­˜å‚¨çš„æ•°æ®ï¼ˆå®‰å…¨ï¼‰
- âœ… é’±åŒ…åœ°å€ï¼ˆå…¬å¼€ä¿¡æ¯ï¼‰
- âœ… å…¬é’¥ï¼ˆå…¬å¼€ä¿¡æ¯ï¼‰
- âœ… æ´¾ç”Ÿè·¯å¾„ï¼ˆå…ƒæ•°æ®ï¼‰
- âœ… é“¾ID/ç¬¦å·ï¼ˆå…ƒæ•°æ®ï¼‰
- âœ… é’±åŒ…åç§°ï¼ˆç”¨æˆ·è‡ªå®šä¹‰ï¼‰

### âŒ åç«¯ä¸å­˜å‚¨çš„æ•°æ®ï¼ˆæ•æ„Ÿï¼‰
- âŒ åŠ©è®°è¯
- âŒ ç§é’¥
- âŒ ç”¨æˆ·å¯†ç 

---

## ğŸš€ æ€§èƒ½æŒ‡æ ‡

| æ“ä½œ | å“åº”æ—¶é—´ | è¯´æ˜ |
|------|---------|------|
| ç»Ÿä¸€åˆ›å»º API | 22-33ms | åŒ…å«åŠ©è®°è¯ç”Ÿæˆ+æ´¾ç”Ÿ+æ•°æ®åº“å­˜å‚¨ |
| çº¯æ´¾ç”Ÿ API | 13ms | åªæ´¾ç”Ÿï¼Œä¸å­˜å‚¨ |
| é“¾åˆ—è¡¨æŸ¥è¯¢ | <1ms | å†…å­˜ç¼“å­˜ |
| åœ°å€éªŒè¯ | <5ms | çº¯è®¡ç®— |

**æ•°æ®åº“å†™å…¥æ€§èƒ½**:
- CockroachDB å•æ¬¡ INSERT: ~10ms
- PostgreSQL å•æ¬¡ INSERT: ~5ms

---

## ğŸ“ å¾…åŠäº‹é¡¹

### çŸ­æœŸä¼˜åŒ–
- [ ] ä» JWT Token æå– tenant_id å’Œ user_idï¼ˆå½“å‰ä½¿ç”¨é»˜è®¤å€¼ï¼‰
- [ ] æ·»åŠ é’±åŒ…æ›´æ–° APIï¼ˆä¿®æ”¹åç§°ã€æ ‡ç­¾ç­‰ï¼‰
- [ ] æ·»åŠ é’±åŒ…åˆ é™¤ APIï¼ˆè½¯åˆ é™¤ï¼‰
- [ ] æ·»åŠ é’±åŒ…åˆ—è¡¨æŸ¥è¯¢ APIï¼ˆæŒ‰user_idåˆ†é¡µï¼‰

### ä¸­æœŸå¢å¼º
- [ ] Bitcoin å®Œæ•´ bech32 åœ°å€å®ç°ï¼ˆå½“å‰ç®€åŒ–ç‰ˆï¼‰
- [ ] Cardano CIP-1852 å®Œæ•´å®ç°
- [ ] Polkadot Sr25519 ç­¾åæ”¯æŒ
- [ ] å¤šç­¾é’±åŒ…æ”¯æŒ

### é•¿æœŸè§„åˆ’
- [ ] ç¡¬ä»¶é’±åŒ…é›†æˆï¼ˆLedger/Trezorï¼‰
- [ ] MPC (Multi-Party Computation) é’±åŒ…
- [ ] ç¤¾äº¤æ¢å¤æœºåˆ¶
- [ ] é’±åŒ…å¤‡ä»½/æ¢å¤æµç¨‹

---

## ğŸ‰ é›†æˆæˆæœæ€»ç»“

### âœ… å·²å®Œæˆ
1. **æ•°æ®åº“å±‚**ï¼šæ‰©å±• wallets è¡¨ï¼Œæ”¯æŒå¤šé“¾å…ƒæ•°æ®ï¼ˆ6ä¸ªæ–°å­—æ®µï¼‰
2. **Repository å±‚**ï¼šæ›´æ–° CRUD æ“ä½œï¼Œæ”¯æŒå¤šé“¾å‚æ•°
3. **Service å±‚**ï¼šæ–°å¢ `create_wallet_with_metadata()` å‡½æ•°
4. **API å±‚**ï¼š3ä¸ªæ–°ç«¯ç‚¹ï¼ˆunified-create, frontend-create, v2/createï¼‰
5. **æµ‹è¯•éªŒè¯**ï¼šæ‰€æœ‰ API æµ‹è¯•é€šè¿‡ï¼Œå“åº”æ—¶é—´<35ms
6. **æ–‡æ¡£å®Œå–„**ï¼šAPIæ–‡æ¡£ã€é›†æˆæŒ‡å—ã€å®‰å…¨è¯´æ˜

### ğŸ† æ ¸å¿ƒä¼˜åŠ¿
- **éæ‰˜ç®¡æ¶æ„**ï¼šåç«¯åªå­˜å‚¨å…ƒæ•°æ®ï¼Œç§é’¥æ°¸è¿œåœ¨å®¢æˆ·ç«¯
- **å¤šé“¾ç»Ÿä¸€**ï¼šä¸€å¥— API æ”¯æŒ 8 æ¡é“¾ï¼ˆå¯æ‰©å±•ï¼‰
- **çµæ´»é›†æˆ**ï¼šæ”¯æŒ3ç§é›†æˆæ–¹æ¡ˆï¼ˆç»Ÿä¸€API/å‰ç«¯æ´¾ç”Ÿ/æ··åˆï¼‰
- **é«˜æ€§èƒ½**ï¼šå“åº”æ—¶é—´<35msï¼Œæ”¯æŒé«˜å¹¶å‘
- **ç”Ÿäº§å°±ç»ª**ï¼šå®Œæ•´é”™è¯¯å¤„ç†ã€æ•°æ®åº“ç´¢å¼•ã€å®¡è®¡æ—¥å¿—

### ğŸ“ˆ æŠ€æœ¯æ ˆ
- **åç«¯**: Rust + Axum 0.7 + SQLx
- **æ•°æ®åº“**: CockroachDB/PostgreSQL
- **åŠ å¯†**: k256 (Secp256k1) + ed25519-dalek + bip39 + coins-bip32
- **æ ‡å‡†**: BIP39, BIP44, BIP84, SLIP-0010, CIP-1852 (partial)

---

## ğŸ“š ç›¸å…³æ–‡æ¡£
- [å¤šé“¾é’±åŒ…æ¶æ„è®¾è®¡](./MULTI_CHAIN_WALLET_ARCHITECTURE.md)
- [API æµ‹è¯•æŠ¥å‘Š](./MULTI_CHAIN_WALLET_TEST_REPORT.md)
- [å‰ç«¯é›†æˆæ–‡æ¡£](../IronForge/FRONTEND_1.0_ARCHITECTURE.md)
- [å®‰å…¨æœ€ä½³å®è·µ](../docs/SECURITY_BEST_PRACTICES.md)

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-11-23  
**ç‰ˆæœ¬**: v1.0.0  
**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª
