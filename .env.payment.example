# ============================================================================
# 法币支付服务商配置（企业级优化方案）
# ============================================================================
# 更新日期: 2025-12-05
# 说明: 配置3个主力服务商 + 2个兜底服务商
# ============================================================================

# ----------------------------------------------------------------------------
# Layer 1: Onramper 聚合器 (优先级 100)
# ----------------------------------------------------------------------------
# 官网: https://onramper.com
# 文档: https://docs.onramper.com
# 用途: 全球主力路由，聚合25+ ramps，95%流量

ONRAMPER_API_KEY=your_onramper_api_key_here
ONRAMPER_SECRET=your_onramper_secret_here
ONRAMPER_WEBHOOK_SECRET=your_onramper_webhook_secret_here

# Onramper费率配置（动态比价，实际费率由聚合器返回）
ONRAMP_FEE_RATE_ONRAMPER=0.005  # 0.5% 基准费率（实际可能更低）

# ----------------------------------------------------------------------------
# Layer 2: TransFi 中国特化 (优先级 90)
# ----------------------------------------------------------------------------
# 官网: https://www.transfi.com
# 文档: https://docs.transfi.com
# 用途: 中国+新兴市场，支付宝/微信支付，80%中国用户

TRANSFI_API_KEY=your_transfi_api_key_here
TRANSFI_SECRET=your_transfi_secret_here
TRANSFI_WEBHOOK_SECRET=your_transfi_webhook_secret_here

# TransFi费率配置
ONRAMP_FEE_RATE_TRANSFI=0.025   # 2.5% (1.5%-3.5%范围)
ONRAMP_EXCHANGE_RATE_TRANSFI=0.995
ONRAMP_MIN_AMOUNT_TRANSFI=50.0    # $50 最小金额
ONRAMP_MAX_AMOUNT_TRANSFI=10000.0 # $10,000 最大金额

# ----------------------------------------------------------------------------
# Layer 2: Alchemy Pay Web3优化 (优先级 85)
# ----------------------------------------------------------------------------
# 官网: https://alchemypay.org
# 文档: https://docs.alchemypay.org
# 用途: Web3场景（DeFi/NFT），亚太优先，70%中国用户

ALCHEMYPAY_API_KEY=your_alchemypay_api_key_here
ALCHEMYPAY_SECRET=your_alchemypay_secret_here
ALCHEMYPAY_WEBHOOK_SECRET=your_alchemypay_webhook_secret_here

# Alchemy Pay费率配置
ONRAMP_FEE_RATE_ALCHEMYPAY=0.020  # 2.0% (1.0%-3.0%范围)
ONRAMP_EXCHANGE_RATE_ALCHEMYPAY=0.996
ONRAMP_MIN_AMOUNT_ALCHEMYPAY=30.0
ONRAMP_MAX_AMOUNT_ALCHEMYPAY=15000.0

# ----------------------------------------------------------------------------
# Layer 3: Ramp Network 低费率兜底 (优先级 70)
# ----------------------------------------------------------------------------
# 官网: https://ramp.network
# 文档: https://docs.ramp.network
# 用途: 欧美用户兜底，费率最低（0.49%-2.9%），40%欧美用户

RAMP_API_KEY=your_ramp_api_key_here
RAMP_SECRET=your_ramp_secret_here
RAMP_WEBHOOK_SECRET=your_ramp_webhook_secret_here

# Ramp费率配置
ONRAMP_FEE_RATE_RAMP=0.015        # 1.5% (0.49%-2.9%范围)
ONRAMP_EXCHANGE_RATE_RAMP=0.997
ONRAMP_MIN_AMOUNT_RAMP=20.0
ONRAMP_MAX_AMOUNT_RAMP=20000.0

# ----------------------------------------------------------------------------
# Layer 3: MoonPay 全球兜底 (优先级 60)
# ----------------------------------------------------------------------------
# 官网: https://www.moonpay.com
# 文档: https://docs.moonpay.com
# 用途: 品牌信任，全球兜底，30%用户

MOONPAY_API_KEY=your_moonpay_api_key_here
MOONPAY_SECRET_KEY=your_moonpay_secret_here
MOONPAY_WEBHOOK_SECRET=your_moonpay_webhook_secret_here

# MoonPay费率配置
ONRAMP_FEE_RATE_MOONPAY=0.030     # 3.0% (1.0%-4.5%范围)
ONRAMP_EXCHANGE_RATE_MOONPAY=0.993
ONRAMP_MIN_AMOUNT_MOONPAY=30.0
ONRAMP_MAX_AMOUNT_MOONPAY=10000.0

# ----------------------------------------------------------------------------
# 通用配置（所有服务商降级使用）
# ----------------------------------------------------------------------------
ONRAMP_FEE_RATE_DEFAULT=0.005             # 默认0.5%费率
ONRAMP_EXCHANGE_RATE_DEFAULT=0.995        # 默认汇率
ONRAMP_MIN_AMOUNT_DEFAULT=10.0            # 默认最小$10
ONRAMP_MAX_AMOUNT_DEFAULT=10000.0         # 默认最大$10,000
ONRAMP_QUOTE_EXPIRES_MINUTES_DEFAULT=15   # 报价15分钟有效

# ----------------------------------------------------------------------------
# 禁用的服务商（已被聚合器覆盖，保留配置以备启用）
# ----------------------------------------------------------------------------
# Simplex (优先级 50, 已禁用)
# SIMPLEX_API_KEY=disabled
# ONRAMP_FEE_RATE_SIMPLEX=0.040  # 4.0% (费率高，不推荐)

# Transak (优先级 50, 已禁用) 
# TRANSAK_API_KEY=disabled
# ONRAMP_FEE_RATE_TRANSAK=0.035  # 3.5% (功能重叠，不推荐)

# Banxa (优先级 50, 已禁用)
# BANXA_API_KEY=disabled
# ONRAMP_FEE_RATE_BANXA=0.030    # 3.0% (无独特优势，不推荐)

# ----------------------------------------------------------------------------
# 健康检查与监控配置
# ----------------------------------------------------------------------------
PROVIDER_HEALTH_CHECK_INTERVAL_SECONDS=300    # 每5分钟检查一次
PROVIDER_CIRCUIT_BREAKER_THRESHOLD=3          # 连续3次失败触发熔断
PROVIDER_CIRCUIT_BREAKER_TIMEOUT_SECONDS=600  # 熔断10分钟
PROVIDER_MAX_RESPONSE_TIME_MS=5000            # 超时5秒

# ----------------------------------------------------------------------------
# 智能路由配置
# ----------------------------------------------------------------------------
# 中国地区国家代码（优先使用TransFi/Alchemy）
CHINA_REGION_CODES=CN,HK,TW,SG

# 聚合器优先（95%场景）
ENABLE_ONRAMPER_AGGREGATOR=true
ONRAMPER_TIMEOUT_SECONDS=30

# 地域优先路由
ENABLE_GEO_ROUTING=true
ENABLE_CHINA_OPTIMIZATION=true

# ----------------------------------------------------------------------------
# 申请流程与时间线
# ----------------------------------------------------------------------------
# Onramper: 申请 https://onramper.com/developers (审批 1-2 天)
# TransFi: 申请 https://www.transfi.com/developers (审批 1-3 天，需KYC)
# Alchemy Pay: 申请 https://alchemypay.org/contact (审批 2-3 天)
# Ramp: 申请 https://ramp.network/get-started (审批 1-2 天)
# MoonPay: 申请 https://www.moonpay.com/dashboard (审批 1-3 天)

# ----------------------------------------------------------------------------
# 注意事项
# ----------------------------------------------------------------------------
# 1. 所有API密钥必须妥善保管，不要提交到Git仓库
# 2. 生产环境必须配置真实API密钥，开发环境可使用默认值
# 3. Webhook密钥用于验证回调签名，防止伪造
# 4. 费率配置支持动态调整，无需重启服务
# 5. 健康检查会自动禁用不可用的服务商，10分钟后自动重试
# 6. 中国用户自动路由到TransFi/Alchemy，无需手动配置
# 7. Onramper聚合器会自动选择最优通道（费率+可用性）

# ----------------------------------------------------------------------------
# 快速测试（使用默认配置）
# ----------------------------------------------------------------------------
# 1. 启动后端: cd IronCore && CONFIG_PATH=config.toml cargo run
# 2. 运行migration: sqlx migrate run
# 3. 测试报价: curl "http://localhost:8088/api/v1/fiat/onramp/quote?amount=100&currency=USD&token=USDT&payment_method=credit_card"
# 4. 预期结果: 返回crypto_amount=99.5, fee_percentage=0.005 (使用默认0.5%费率)

# ============================================================================
# EOF - 企业级支付配置完成
# ============================================================================
